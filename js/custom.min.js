d3.queue().defer(d3.csv,"data/co2_mm_mlo.csv").defer(d3.csv,"data/all.csv").await(function(d,c,e){function b(a,f,b){var h=d3.swoopyDrag().x(function(a){return a.xVal}).y(function(a){return a.yVal}).draggable(0);h.annotations(f);d3.select(a+(b?" svg + svg":" svg")).append("g.annotations").call(h)}function n(a,f,b,h){var c,d,g,e,k,l;void 0===h?(c=80,d=100,h=110,g=p,e=q,k="anomaly",l="date"):(c=25,d=35,h=60,g=r,e=t,k="interpolated",l="co2_date");a=d3.select(a).append("svg").attr("width",72+m.left+m.right).attr("height",
    h).attr("class","svg").call(f).selectAll("bar").data(b);a.enter().append("rect").merge(a).attr("x",function(a){return g(a[l])}).attr("width",_.floor(72/b.length,3)).attr("y",0).attr("height",c).translate([m.left,0]).style("fill",function(a){return e(a[k])}).on("mouseover touchstart",function(a){d3.select(this).attr("height",d).style("fill","lightgray");f.show.call(this,a)}).on("mouseout touchend",function(a){d3.select(this).attr("height",c).style("fill",function(a){return e(a[k])});f.hide.call(this,
    a)});a.exit().remove();return a}function u(a,b,c){var f,d;void 0!==c?(f=90,d=85):(f=70,d=0);c=a.substr(1);a=d3.select(a).append("svg").classed("svg",!0).classed("legend",!0).attr("width",1E3).attr("height",75);a.append("g").attr("class","legend-"+c).attr("width",1E3).translate([d,20]);b=d3.legendColor().shapeWidth(f).orient("horizontal").labelFormat(d3.format(".02f")).scale(b);a.select(".legend-"+c).call(b);return a}function v(a){return"January February March April May June July August September October November December".split(" ")[parseInt(a,
    10)-1]}var m={top:25,right:50,bottom:50,left:40},x=d3.timeParse("%m/%Y"),w=d3.timeParse("%m"),g=d3.format(".2f");c.forEach(function(a){a.month=10>a.month?"0"+a.month:a.month;a.date=x(a.month+"/"+a.year);a.co2_date=w(a.month);a.interpolated=+a.interpolated});var y=d3.tip().attr("class","d3-tip").html(function(a){return'<h4 class="text-center">'+v(a.month)+" ("+a.year+')</h4><ul class="list-unstyled"><li class="text-center"><h4>Temperatures</h4></li><li>Historical Avg: '+g(a.historic_avg)+" degrees (C)</li><li>Actual Avg: "+
    g(a.actual_avg)+" degrees (C)</li><li>Departure from Avg: "+g(a.anomaly)+" degrees (C)</li></ul>"}),z=d3.tip().attr("class","d3-tip").html(function(a){return'<h4 class="text-center">'+v(a.month)+" ("+a.year+')</h4><ul class="list-unstyled"><li class="text-center"><h4>CO<sub>2</sub> Levels</h4></li><li>Average: '+g(a.interpolated)+" parts per million</li><li>Long Term Trend: "+g(a.trend)+" parts per million</li></ul>"});e.forEach(function(a){a.date=w(a.month);a.anomaly=+a.anomaly});d=_.sortByOrder(e,
    ["year","month"]).filter(function(a){return"ocean_land"===a.type});var p=d3.scaleTime().range([0,72]);p.domain(d3.extent(d,d3.f("date")));var r=d3.scaleTime().range([0,72]);r.domain(d3.extent(c,d3.f("co2_date")));e="#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" ").reverse();var q=d3.scaleQuantize().domain([-1.25,1.25]).range(e),t=d3.scaleQuantize().domain(d3.extent(c,d3.f("interpolated"))).range("#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #54278f #3f007d".split(" "));
    u("#year-legend",q);u("#co2-legend",t,!0);d=d3.nest().key(function(a){return a.year}).entries(d);var A=d3.nest().key(function(a){return a.year}).entries(c);d.forEach(function(a,b){d3.select("#year-temp").append("div").attr("class","graph").attr("id","graphed"+b);d3.select("#graphed"+b).append("h4").attr("class","text-center text-top").text(a.key);78<=b&&n("#graphed"+b,z,A[b-78].values,!0);n("#graphed"+b,y,a.values)});c=[{xVal:"11",yVal:0,path:"M78,38L96,19",text:"Long term trend tops 350ppm",textOffset:[-1,
        50]}];b("#graphed13",[{xVal:"01",yVal:0,path:"M59,100L42,75",text:"Greatest below avg month",textOffset:[17,108]}],!1);b("#graphed99",[{xVal:"12",yVal:0,path:"M67,96L103,78",text:"First anomaly of 0.50C",textOffset:[-6,107]}],!0);b("#graphed104",[{xVal:"12",yVal:0,path:"M67,96L103,78",text:"Most recent below avg month",textOffset:[-6,107]}],!0);b("#graphed106",[{xVal:"05",yVal:0,path:"M78,38L64,20",text:"First month above 350ppm",textOffset:[5,50]}],!1);b("#graphed107",c,!1);b("#graphed107",c,!0);
    b("#graphed118",[{xVal:"02",yVal:0,path:"M68,96L48,75",text:"First anomaly above 0.75C",textOffset:[5,108]}],!0);b("#graphed122",[{xVal:"04",yVal:0,path:"M78,38L59,20",text:"First month at 375ppm",textOffset:[5,50]}],!1);b("#graphed123",[{xVal:"04",yVal:0,path:"M78,38L59,20",text:"Long term trend tops 375ppm",textOffset:[-1,50]}],!1);b("#graphed134",[{xVal:"03",yVal:0,path:"M78,38L59,23",text:"First month above 400ppm",textOffset:[5,50]}],!1);b("#graphed135",[{xVal:"03",yVal:0,path:"M78,38L59,23",
        text:"Long term trend tops 400ppm",textOffset:[-1,50]}],!1);b("#graphed135",[{xVal:"12",yVal:0,path:"M59,100L103,76",text:"1st anomaly above 1C",textOffset:[17,108]}],!0);b("#graphed136",[{xVal:"03",yVal:0,path:"M65,99L54,77",text:"Greatest above avg month",textOffset:[17,108]}],!0);c=d3.selectAll(".row");c.classed("opaque",!1);c.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});